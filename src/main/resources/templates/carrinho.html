<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carrinho - Love Makeup BL</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
    <header>
        <div class="header-top">
            <a href="/" class="logo"><i class="fas fa-heart"></i> Love Makeup BL</a>
            <div class="header-actions">
                <a href="/carrinho" class="cart-icon">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-count" style="display: none;">0</span>
                </a>
                <a href="/perfil" class="profile-icon"><i class="fas fa-user"></i></a>
            </div>
        </div>
        <nav>
            <ul>
                <li><a href="/">Home</a></li>
                <li><a href="/produtos">Produtos</a></li>
                <li><a href="/sobre">Quem Somos</a></li>
                <li><a href="/contato">Contato</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <div class="container">
            <h1 style="color: #d4477d; margin-bottom: 2rem;">Seu Carrinho</h1>

            <div class="cart-container">
                <div class="cart-items">
                    <!-- Conte칰do do carrinho ser치 preenchido pelo JavaScript -->
                </div>

                <div class="cart-summary" style="display: none;">
                    <!-- Resumo ser치 preenchido pelo JavaScript -->
                </div>
            </div>

            <div style="text-align: center; margin-top: 2rem;">
                <a href="/produtos" class="cta-button">
                    <i class="fas fa-arrow-left"></i> Continuar Comprando
                </a>
            </div>
        </div>
    </main>

    <footer>
        <p>&copy; 2026 Love Makeup BL - Bel치gua, Maranh칚o</p>
        <p>Rua Nova, n췈 4 - Centro</p>
        <p><a href="https://wa.me/5598991237578" target="_blank">WhatsApp: (98) 99123-7578</a></p>
    </footer>

    <script th:src="@{/js/app.js}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            renderCarrinho();
        });

        function renderCarrinho() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const cartItemsDiv = document.querySelector('.cart-items');
            const cartSummaryDiv = document.querySelector('.cart-summary');

            if (cart.length === 0) {
                cartItemsDiv.innerHTML = `
                    <div class="empty-cart">
                        <i class="fas fa-shopping-cart" style="font-size: 3rem; color: #ddd; margin-bottom: 1rem;"></i>
                        <p>Seu carrinho est치 vazio</p>
                        <a href="/produtos" class="cta-button" style="margin-top: 1rem;">Explorar Produtos</a>
                    </div>
                `;
                cartSummaryDiv.style.display = 'none';
                return;
            }

            cartSummaryDiv.style.display = 'block';

            cartItemsDiv.innerHTML = cart.map(item => `
                <div class="cart-item">
                    <img src="${item.image}" alt="${item.name}" class="cart-item-image">
                    <div class="cart-item-details">
                        <div class="cart-item-name">${item.name}</div>
                        <div class="cart-item-price">R$ ${item.price.toFixed(2)}</div>
                        <div class="cart-item-actions">
                            <button onclick="updateCartQty(${item.id}, ${item.quantity - 1})">-</button>
                            <input type="number" value="${item.quantity}" style="width: 50px; text-align: center; padding: 0.4rem;"
                                   onchange="updateCartQty(${item.id}, this.value)" min="1">
                            <button onclick="updateCartQty(${item.id}, ${item.quantity + 1})">+</button>
                            <button onclick="removeFromCart(${item.id})" style="background: #ff6b6b; color: white;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');

            updateCartSummary();
        }

        function updateCartQty(id, qty) {
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            const item = cart.find(i => i.id === id);
            if (item) {
                item.quantity = Math.max(1, parseInt(qty));
                localStorage.setItem('cart', JSON.stringify(cart));
                renderCarrinho();
            }
        }

        function removeFromCart(id) {
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            cart = cart.filter(item => item.id !== id);
            localStorage.setItem('cart', JSON.stringify(cart));
            cartManager.updateCartCount();
            renderCarrinho();
        }

        function updateCartSummary() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const subtotal = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
            const shipping = subtotal > 100 ? 0 : 10;
            const total = subtotal + shipping;

            document.querySelector('.cart-summary').innerHTML = `
                <div class="summary-row">
                    <span>Subtotal:</span>
                    <span>R$ ${subtotal.toFixed(2)}</span>
                </div>
                <div class="summary-row">
                    <span>Frete:</span>
                    <span>${shipping === 0 ? 'GR츼TIS' : 'R$ ' + shipping.toFixed(2)}</span>
                </div>
                <div class="summary-row total">
                    <span>Total:</span>
                    <span>R$ ${total.toFixed(2)}</span>
                </div>
                <button class="checkout-btn" onclick="finalizarCompra()">
                    <i class="fab fa-whatsapp"></i> Finalizar no WhatsApp
                </button>
                <button class="checkout-btn" style="background: #999; margin-top: 0.5rem;" onclick="limparCarrinho()">
                    <i class="fas fa-trash"></i> Limpar Carrinho
                </button>
            `;
        }

        function finalizarCompra() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            if (cart.length === 0) {
                alert('Carrinho vazio!');
                return;
            }

            let endereco = '';
            const user = JSON.parse(localStorage.getItem('user'));

            // Se usu치rio n칚o tem endere칞o cadastrado, solicita
            if (!user || !user.endereco) {
                endereco = prompt('Por favor, informe seu endere칞o de entrega:');
                if (!endereco) {
                    alert('Endere칞o 칠 necess치rio para finalizar a compra!');
                    return;
                }

                // Se usu치rio existe, atualiza com endere칞o
                if (user) {
                    user.endereco = endereco;
                    localStorage.setItem('user', JSON.stringify(user));
                }
            } else {
                endereco = user.endereco;
            }

            const items = cart.map(item =>
                `游닍 ${item.name} - Qty: ${item.quantity} - R$ ${(item.price * item.quantity).toFixed(2)}`
            ).join('%0A');

            const subtotal = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
            const shipping = subtotal > 100 ? 0 : 10;
            const total = (subtotal + shipping).toFixed(2);

            const nomeCliente = user ? `${user.nome}` : 'Cliente';
            const telefone = user ? user.telefone : 'N칚o informado';

            const message = `Ol치 Love Makeup BL! 游눇%0A%0A*NOVO PEDIDO*%0A%0A游녻 Cliente: ${nomeCliente}%0A游님 Telefone: ${telefone}%0A游늸 Endere칞o: ${endereco}%0A%0A*PRODUTOS:*%0A${items}%0A%0A游눱 Subtotal: R$ ${subtotal.toFixed(2)}%0A游뚴 Frete: ${shipping === 0 ? 'GR츼TIS' : 'R$ ' + shipping.toFixed(2)}%0A游눯 *Total: R$ ${total}*`;

            window.open(`https://wa.me/5598991237578?text=${message}`, '_blank');

            localStorage.removeItem('cart');
            cartManager.updateCartCount();
            renderCarrinho();
        }

        function limparCarrinho() {
            if (confirm('Tem certeza que deseja limpar o carrinho?')) {
                localStorage.removeItem('cart');
                cartManager.updateCartCount();
                renderCarrinho();
            }
        }
    </script>
</body>
</html>

